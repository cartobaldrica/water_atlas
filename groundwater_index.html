<!DOCTYPE html>
<html lang="en">
<head>
    <title>Groundwater</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta property="og:title" content="Oregon Drinking Water" />
    <meta property="og:url" content="http://rawgit.com/cartobaldrica/water_atlas/master/drinking_index.html" />
    <meta property="og:description" content="Explore Oregon's drinking water." />
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
    <link rel="stylesheet" type="text/css" href="css/drinking_style.css">
    <link rel="stylesheet" href="css/control-minimap2.css" />
    <link rel="stylesheet" href="css/ekko-lightbox.css"/>        
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inconsolata" />

	<link rel="shortcut icon" href="img/oregon.ico" type="image/x-icon">
	
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">


    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/leaflet.ajax.min.js"></script>
    <script src="js/storymap_fixed.js"></script>
	<script src="js/ekko-lightbox.js"></script>
	<script src="js/control-minimap.js" type="text/javascript"></script>
	
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-4 main">
        
             <section data-scene="overview">
				 	<div class= "overview-background-img background-fullscreen-setting text-responsive text-shadow: black 0.2em 0.2em 0.3em;"><h4 class="text-center">Groundwater</h4><h4 class ="text-center" style="font-size:20px; margin-top:0px; color: #ffffff; text-shadow: black 0.2em 0.2em 0.3em; margin-left: 20%; margin-right:20%">The Willamette Valley has a reputation for its drinking water. Over 80% of Oregonians get drinking water from public water systems. Many of these systems rely on some combination of ground and surface water sources. From the pristine Bull Run watershed, to the groundwater wells of Eastern Oregon, maintaining quality drinking water requires continual testing and communication.</h4></div>
                	<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>            
            </section>
            
             <section data-scene="recharge">
                <h3>Aquifers and Recharge</h3>
                <p>Only 10% of Oregon drinking water authorities offer solely surface water, while 55% offer some combination of surface water and groundwater. The Bull Run watershed and the Bull Run reservoir, maintained by the Portland Water Bureau, is perhaps most notable surface water source in the state. Elsewhere within the Willamette Valley, surface water is also typically stored in reservoirs, although river water is treated and distributed as well.</p>
			</section>     
			
			<section  data-scene="irrigation_aquifers">
                <h3>Irrigation Aquifers</h3>
                <p>Once contaminant sources are identified, communities can work with land managers to spearhead plans to ensure drinking water quality. Surface and ground water sources are susceptible to different contaminant sources. The OHA mandates certain treatment and filtration requirements for public water providers. However, private well owners are responsible for testing their own water quality.</p>
                <p>Potential contaminants are sorted into three risk categories, with highest risk sources maintaining the most potential for effect. Even if drinking water providers do identify contaminants, it can be difficult to locate their origin, highlighting the importance of preventative action and strategies.</p>
            </section> 
    		
    		<section  data-scene="county_use">
                <h3>Use by County</h3>
                <p>The Oregon DEQ, in combination with the Oregon Health Authority, assess potential contaminants in drinking water source zones. Assessments allow local communities to address areas of concern to prevent drinking water pollution. While areas with high populations are prone to large numbers of potential contaminants, rural agricultural areas can also have a variety of contaminant sources.</p>
           	    <p>The grid identifies areas with large numbers of potential contaminants sources.</p>
            </section>      
             
            <section data-scene="conservation_critical">
                <h3>Critical</h3>
                <p>35% of Oregonians rely on groundwater, typically from either small public water systems or private wells. Groundwater recharge areas require different protection strategies than surface watersheds. Wells are more commonly utilized in drier parts of the state.</p>
          	    <p>In the Willamette Valley, groundwater is often used as an emergency water source. It is typically utilized when contaminants are found in surface water areas, or when reservoirs are low.</p>
            </section>
            
            <section data-scene="conservation_management">
                <h3>Management</h3>
                <p>35% of Oregonians rely on groundwater, typically from either small public water systems or private wells. Groundwater recharge areas require different protection strategies than surface watersheds. Wells are more commonly utilized in drier parts of the state.</p>
          	    <p>In the Willamette Valley, groundwater is often used as an emergency water source. It is typically utilized when contaminants are found in surface water areas, or when reservoirs are low.</p>
            </section>
   
            <section data-scene="end">
				 	<div class= "end-background-img background-fullscreen-setting text-responsive"><br>
                	<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>     
            </section>
        	
        	<i class="animated zoomIn infinite glyphicon glyphicon-menu-down arrow-down"></i>

        </div>
        <div id="map" class="col-sm-6 col-md-8 sidebar"></div>
    </div>
    
    <i class="fa fa-info-circle social" style="top:10px" data-toggle="modal" data-target="#info-modal"></i>
    
	<a class="fa fa-facebook-square social2" style="top:28px" href="https://facebook.com/sharer.php?u=http://rawgit.com/cartobaldrica/water_atlas/master/drinking_index.html" target="_blank"></a>
    
    <ul class="navbar text-center"></ul>

    
    <div class="modal fade" id="info-modal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h2 class="modal-title">About</h2>
                </div>
                <div class="modal-body">
                    <p2>Cover Photo by Sam Beebe/Ecotrust - retrieved from Wikimedia Commons</p2><br>
                    <p2 style="font-size:20px">Geographic Data</p2><br>
                    <p2>Surface, Ground and Contaminant Sources: Oregon Department of Environmental Quality - retrieved from Oregon Spatial Data Library</p2><br>
                	<p2 style="font-size:20px">Text Data</p2><br>
                	<p2>Drinking water statistics and information: Oregon DEQ, Oregon Health Authority, Portland Water Bureau</p2>
                </div>
                <div class="modal-footer">
                    <p2>Created with Leaflet</p>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
</div>


<script type="text/javascript">

//conservation management        
    function consOpacity(string){
        if (string == "GWMA") {return 0.8}
        else {return 0}
    }
    	
     function consStyle(feature) {
        return {
            fillColor: '#ffa458',
            fillOpacity: consOpacity(feature.properties.Type),
            weight: 1.5,
            color: '#ffffff',
            opacity: consOpacity(feature.properties.Type),
        };
    }
//conservation critical areas    
    function critOpacity(string){
        if (string == "GWMA") {return 0}
        else {return 0.8}
    }
    
    function critColor(string){
        if (string == "GWCA") {return '#f8000c'}
        else {return '#ffa458'}
    }
    	
     function critStyle(feature) {
        return {
            fillColor: critColor(feature.properties.Type),
            fillOpacity: critOpacity(feature.properties.Type),
            weight: 1.5,
            color: '#ffffff',
            opacity: critOpacity(feature.properties.Type),
        };
    }
    	
    function highlightFeature(e) {
    	var layer = e.target;
    	layer.bringToFront();
    }
    
//counties1
    function setCountyColor(density){
        return density > 300 ? '#f8000c' :
        density > 200 ? '#ff6343':
        density > 100 ? '#ffa458':
        density > 25 ? '#ffd58d':
        '#feffcd';
    }
    
    function countyStyle(feature) {
        return {
           fillColor: setCountyColor(feature.properties.total), 
           fillOpacity: .8, 
           color: '#ffffff', 
           radius: 4, 
           opacity: .8, 
           weight: 1
        };
    }
    
    function highlightCounty(e) {
    	var layer = e.target;
    	
    	layer.setStyle({
        	fillOpacity: 1,
        	weight: 2
    	});
    	layer.bringToFront();
    }
    
    function resetCounty(e) {
    	var layer = e.target;
    	
    	layer.setStyle({
           	fillOpacity: 0.8,
        	weight: 1
    	});
    }
//counties2
    function countyStyle2(feature) {
        return {
           fillOpacity: 0, 
           color: '#ffffff', 
           opacity: 1, 
           weight: .5,
           clickable: false
        };
    }
//groundwater recharge
 	  function gwColor(string1, string2){
        if (string1 == 1 && string2 == 1) {return '#ebebe0'}
        else if (string1 == 1 && string2 == 2) {return '#ccccb3'}
        else if (string1 == 1 && string2 == 3) {return '#a3a375'}
        else if (string1 == 1 && string2 == 4) {return '#5c5c3d'}
        else if (string1 == 2 && string2 == 1) {return '#ecf9ec'}
        else if (string1 == 2 && string2 == 2) {return '#b3e6b3'}
        else if (string1 == 2 && string2 == 3) {return '#66cc66'}
        else if (string1 == 2 && string2 == 4) {return '#267326'}
        else if (string1 == 3 && string2 == 1) {return '#e6ecff'}
        else if (string1 == 3 && string2 == 2) {return '#99b3ff'}
        else if (string1 == 3 && string2 == 3) {return '#4d79ff'}
        else if (string1 == 3 && string2 == 4) {return '#0033cc'}
        else {return 1}
   	}
    function gwStyle(feature) {
        return {
           fillColor: gwColor(feature.properties.Z, feature.properties.recharge), 
           fillOpacity: .7, 
           color: gwColor(feature.properties.Z, feature.properties.recharge), 
           opacity: .7, 
           weight: 1
        };
    }
    function gwStyle2(feature) {
        return {
           color: gwColor(feature.properties.Z, feature.properties.recharge), 
        };
    }
    
    function highlightGroundwater(e) {
    	var layer = e.target;
    	
    	layer.setStyle({
        	color: '#ffffff',
        	fillOpacity: 1,
        	weight: 2
    	});
    	layer.bringToFront();
    }
    
    function resetGroundwater(e) {
    	var layer = e.target;
    	
    	layer.setStyle({
           	color: gwStyle2,
           	fillOpacity: 0.7,
        	weight: 1
    	});
    }
// 
	var surface_style2 = {fillColor: '#b3d1ff', fillOpacity: 1, color: '#4d94ff', radius: 1, opacity: 1, weight: 1};

	var legend_recharge = '<p style="text-align: left;">Recharge(mm/yr) Aquifer </p><p style="text-align: left;">0 20 100 500</p><i style="background: #e6ecff; fillOpacity: .7; color:#e6ecff; margin-right: 0px;   weight: 1; opacity: 0.7; width: 20px;  "></i><i style="background: #99b3ff; fillOpacity: .7; color:#99b3ff; width: 20px;   margin-right: 0px;   weight: 1; opacity: 0.7; "></i><i style="background: #4d79ff; fillOpacity: .7; color:#4d79ff; margin-right: 0px;   width: 20px;   weight: 1; opacity: 0.7;"></i><i style="background: #0033cc; fillOpacity: .7; color:#0033cc; margin-right: 0px;  width: 20px; weight: 1; opacity: 0.7; "></i><p style="text-align: left;">Gravel</p><i style="background: #ecf9ec; fillOpacity: .7; color:#ecf9ec; margin-right: 0px;   weight: 1; opacity: 0.7; width: 20px;  "></i><i style="background: #b3e6b3; fillOpacity: .7; color:#b3e6b3; width: 20px;   margin-right: 0px;   weight: 1; opacity: 0.7;"></i><i style="background: #66cc66; fillOpacity: .7; color:#66cc66; margin-right: 0px;   width: 20px;   weight: 1; opacity: 0.7;"></i><i style="background: #267326; fillOpacity: .7; color:#267326; margin-right: 0px;   width: 20px;   weight: 1; opacity: 0.7;"></i><p style="text-align: left;">Igneous</p><i style="background: #ebebe0; fillOpacity: .7; color:#ebebe0; margin-right: 0px;   weight: 1; opacity: 0.7; width: 20px;  "></i><i style="background: #ccccb3; fillOpacity: .7; color:#ccccb3; width: 20px;   margin-right: 0px;   weight: 1; opacity: 0.7;"></i><i style="background: #a3a375; fillOpacity: .7; color:#a3a375; margin-right: 0px;   width: 20px;   weight: 1; opacity: 0.7;"></i><i style="background: #5c5c3d; fillOpacity: .7; color:#5c5c3d; margin-right: 0px;   width: 20px;   weight: 1; opacity: 0.7;"></i><p style="text-align: left;">Other</p>';
	var legend_irrigation = '<p style="text-align: left; font-weight:bold">Groundwater Irrigation Rights</p><br><p style="text-align: left;  style = "margin-top:20px;">Aquifer Type</p><img src="img/sandgravel.png" style="height:6px; width:6px; margin-top:11px; margin-left:1px;"><p style = "margin-top:5px;">Sand and Gravel</p><img src="img/igneous.png" style="height:6px; width:6px; margin-top:11px; margin-left:1px;"><p style = "margin-top:5px;">Igneous/Metamorphic</p><img src="img/other.png" style="height:6px; width:6px; margin-top:11px; margin-left:1px;"><p style = "margin-top:5px;">Other Rocks</p>';
	var legend_county ='<p style ="font-weight: bold;">2010 Groundwater Use in Mgal/day</p><i style="background: #f8000c; opacity: 0.8"></i><p>300+</p><i style="background: #ff6343; opacity: 0.8"></i><p>200 - 300</p><i style="background: #ffa458; opacity: 0.8"></i><p>100 - 200</p><i style="background: #ffd58d; opacity: 0.8"></i><p>25 - 100</p><i style="background: #feffcd; opacity: 0.8"></i><p>0 - 25</p>'

    var legend_crit = '<i style="background: #f8000c; fillOpacity: .8; weight: 1; opacity: 0.8; border:1px solid #fffff"></i><b><p style="text-align: left; margin-left: 25px">GW Critical Area</b></p><i style="background: #ffa458; fillOpacity: .8; weight: 1; opacity: 0.8; border:1px solid #fffff"></i><b><p style="text-align: left; margin-left: 25px">GW Limited Area</b></p>';
    var legend_manage = '<i style="background: #ffa458; fillOpacity: .8; weight: 1; opacity: 0.8; border:1px solid #fffff"></i><b><p style="text-align: left; margin-left: 25px">GW Management Area</b></p>';
		
//<p style="text-align:left; font-weight:bold">Hover for source</p>'

    var layers = {  	
            'counties': [L.geoJson.ajax('http://mapio.us/geoserver/baldricg_atlas/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_atlas:gw_counties&maxFeatures=10000&outputFormat=application%2Fjson',
            	{style:countyStyle, onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip(feature.properties.INSTNAME + " : "+feature.properties.total+" Mgal/day", {className: 'label_tooltip'});
        			featureLayer.on({
        					mouseover: highlightCounty,
        					mouseout: resetCounty
        				})
    			}}
            	), legend_county],	
            'county_outlines': [L.geoJson.ajax('http://mapio.us/geoserver/baldricg_atlas/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_atlas:gw_counties&maxFeatures=10000&outputFormat=application%2Fjson',
            	{style:countyStyle2}
            	)],
            'conservation_critical': [L.geoJson.ajax('http://mapio.us/geoserver/baldricg_atlas/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_atlas:groundwater_conservation&maxFeatures=500&outputFormat=application%2Fjson',
            	{style:critStyle, onEachFeature: function(feature, featureLayer) {
            		if (feature.properties.Type != 'GWMA'){
        				featureLayer.bindTooltip(feature.properties.NAME, {className: 'label_tooltip'});
        				featureLayer.bindPopup(feature.properties.NAME, {className: 'label_tooltip'});
        				featureLayer.on({
        					add: highlightFeature,
        					mouseover: highlightCounty,
        					mouseout: resetCounty
        				})
        			}
        			
    			}}
            	), legend_crit],
            'groundwater_dissolved': [L.geoJson.ajax('http://mapio.us/geoserver/baldricg_atlas/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_atlas:groundwater_dissolved&maxFeatures=50&outputFormat=application%2Fjson',
            	{style:gwStyle, onEachFeature: function(feature, featureLayer) {
        				featureLayer.bindTooltip(feature.properties.rock_type + "<br>" + "Avg. Recharge Rate: " + feature.properties.rate + " mm/yr", {className: 'label_tooltip', sticky: true});
    					featureLayer.bindPopup(feature.properties.rock_type + "<br>" + "Avg. Recharge Rate: " + feature.properties.rate + " mm/yr", {className: 'label_tooltip', sticky: false});
    					featureLayer.on({
        					mouseover: highlightGroundwater,
        					mouseout: resetGroundwater
        				})
        				
    				}}
            	), legend_recharge],
        	'conservation_management': [L.geoJson.ajax('http://mapio.us/geoserver/baldricg_atlas/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_atlas:groundwater_conservation&maxFeatures=500&outputFormat=application%2Fjson',
            	{style:consStyle, onEachFeature: function(feature, featureLayer) {
            		if (feature.properties.Type == 'GWMA'){
        				featureLayer.bindTooltip(feature.properties.NAME, {className: 'label_tooltip'});
        				featureLayer.bindPopup(feature.properties.NAME, {className: 'label_tooltip'});
        				featureLayer.on({
        					add: highlightFeature,
        					mouseover: highlightCounty,
        					mouseout: resetCounty
        				})
        			}
        			
    			}}
            	), legend_manage],
            'groundwater_reprojected': [L.tileLayer.wms("http://mapio.us/geoserver/baldricg_atlas/wms", {
        			layers: 'baldricg_atlas:groundwater_reprojected',
        			format: 'image/png',
        			minZoom: 6,
        			maxZoom: 15,
        			transparent: true,
    			})],
    		'irrigation': [L.tileLayer.wms("http://mapio.us/geoserver/baldricg_atlas/wms", {
        			layers: 'baldricg_atlas:groundwater_irrigation',
        			format: 'image/png',
        			minZoom: 11,
        			maxZoom: 15,
        			transparent: true,
    			}), legend_irrigation],
    		'irrigation_points': [L.tileLayer.wms("http://mapio.us/geoserver/baldricg_atlas/wms", {
        			layers: 'baldricg_atlas:groundwater_irrigation_points',
        			format: 'image/png',
        			minZoom: 6,
        			maxZoom: 10,
        			transparent: true,
    			})],
    		'elevation': [L.tileLayer.wms("http://mapio.us/geoserver/baldricg_basemap/wms", {
        			layers: 'baldricg_basemap:or_relief',
        			format: 'image/png',
        			minZoom: 6,
        			maxZoom: 10,
        			transparent: true,
    			})]
    		
    };

    var scenes = {
            overview: {lat: 44.1347254, lng:-122.7411479, zoom: 7, position:'fullpage'},
            recharge: {lat: 44.1347254, lng:-122.7411479, zoom: 7, layers:['elevation','groundwater_dissolved']},
            conservation_critical: {lat: 44.1347254, lng:-122.7411479, zoom: 7, layers:['conservation_critical']},
            conservation_management: {lat: 44.1347254, lng:-122.7411479, zoom: 7, layers:['conservation_management']},
            county_use: {lat: 44.1347254, lng:-122.7411479, zoom: 7, layers:['counties']},
            irrigation_aquifers: {lat: 44.1347254, lng:-122.7411479, zoom: 7, layers:['irrigation_points','irrigation']},
            end: {lat: 44.1347254, lng:-122.7411479, zoom: 7, position:'fullpage'}
    };
    
    

    $('.main').storymap({
        scenes: scenes,
        layers:layers,
        legend: true,
        scale:false,
        navbar: true,
        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
                var map = L.map('map',{zoomControl:false,  scrollWheelZoom:false}).setView([44.1347254, -122.7411479], 7);
            // add an basemap, which can be either OSM, mapbox, tilelayer, wmslayer or those designed by yourself.
           		/*L.tileLayer.wms("http://localhost:8080/geoserver/basemap/wms", {
        			layers: 'basemap:basemap_dark',
       				format: 'image/png',
       				minZoom: 6,
        			maxZoom: 15,
        			transparent: true,
        		attribution: "Created by Gareth Baldrica-Franklin"
    			}).addTo(map);
    			
    			L.tileLayer.wms("http://localhost:8080/geoserver/basemap/wms", {
        			layers: 'basemap:basemap_dark_labels',
        			format: 'image/png',
        			minZoom: 6,
        			maxZoom: 15,
        			transparent: true,
        			tiled: true, 
        			tilesorigin: [-180, 90]
    			}).addTo(map);
    			*/
    			
    			var CartoDB_DarkMatterNoLabels = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
					subdomains: 'abcd',
					maxZoom: 15,
					minZoom: 6
				}).addTo(map);
 				
 				var mini = new L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
					subdomains: 'abcd',
					maxZoom: 8,
					minZoom: 5
				});
				
				var miniMap = new L.Control.MiniMap(mini, { toggleDisplay: false});
 				
				miniMap.addTo(map);
			
					new L.Control.Zoom({ position: 'bottomright'}).addTo(map);

				/*if (scene == 'portland'){
				miniMap;
				}*/

            return map;
        }
    });
    
    document.getElementsByClassName("leaflet-control-attribution")[0].style.visibility = "hidden";

    
    $(document).on('click', '[data-toggle="lightbox"]', function(event) {
   		event.preventDefault();
    $(this).ekkoLightbox();
	});

</script>
</body>
</html>