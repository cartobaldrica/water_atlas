<!DOCTYPE html>
<html lang="en">
<head>
    <title>Oregon Drinking Water</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta property="og:title" content="Oregon Drinking Water" />
    <meta property="og:url" content="http://rawgit.com/cartobaldrica/water_atlas/master/drinking_index.html" />
    <meta property="og:description" content="Explore Oregon's drinking water." />
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
    <link rel="stylesheet" type="text/css" href="css/drinking_style.css">
    <link rel="stylesheet" href="css/control-minimap2.css" />
    <link rel="stylesheet" href="css/ekko-lightbox.css"/>        
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inconsolata" />

	<link rel="shortcut icon" href="img/oregon.ico" type="image/x-icon">
	
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">


    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/leaflet.ajax.min.js"></script>
    <script src="js/storymap_fixed.js"></script>
	<script src="js/ekko-lightbox.js"></script>
	<script src="js/control-minimap.js" type="text/javascript"></script>
	
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-4 main">
        
             <section data-scene="overview">
				 	<div class= "overview-background-img background-fullscreen-setting text-responsive text-shadow: black 0.2em 0.2em 0.3em;"><h4 class="text-center">Drinking Water</h4><h4 class ="text-center" style="font-size:20px; margin-top:0px; color: #ffffff; text-shadow: black 0.2em 0.2em 0.3em; margin-left: 20%; margin-right:20%">The Willamette Valley has a reputation for its drinking water. Over 80% of Oregonians get drinking water from public water systems. Many of these systems rely on some combination of ground and surface water sources. From the pristine Bull Run watershed, to the groundwater wells of Eastern Oregon, maintaining quality drinking water requires continual testing and communication.</h4></div>
                	<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>            
            </section>
            
             <section data-scene="surface">
                <h3>Surface</h3>
                <p>Only 10% of Oregon drinking water authorities offer solely surface water, while 55% offer some combination of surface water and groundwater. The Bull Run watershed and the Bull Run reservoir, maintained by the Portland Water Bureau, is perhaps most notable surface water source in the state. Elsewhere within the Willamette Valley, surface water is also typically stored in reservoirs, although river water is treated and distributed as well.</p>
			</section>           
            
            <section data-scene="ground">
                <h3>Ground</h3>
                <p>35% of Oregonians rely on groundwater, typically from either small public water systems or private wells. Groundwater recharge areas require different protection strategies than surface watersheds. Wells are more commonly utilized in drier parts of the state.</p>
          	    <p>In the Willamette Valley, groundwater is often used as an emergency water source. It is typically utilized when contaminants are found in surface water areas, or when reservoirs are low.</p>
            </section>

    		<section  data-scene="contaminant_grid">
                <h3>Drinking Water Protection</h3>
                <p>The Oregon DEQ, in combination with the Oregon Health Authority, assess potential contaminants in drinking water source zones. Assessments allow local communities to address areas of concern to prevent drinking water pollution. While areas with high populations are prone to large numbers of potential contaminants, rural agricultural areas can also have a variety of contaminant sources.</p>
           	    <p>The grid identifies areas with large numbers of potential contaminants sources.</p>
            </section>    
            
            <section  data-scene="contaminants">
                <h3>Contaminant Sources</h3>
                <p>Once contaminant sources are identified, communities can work with land managers to spearhead plans to ensure drinking water quality. Surface and ground water sources are susceptible to different contaminant sources. The OHA mandates certain treatment and filtration requirements for public water providers. However, private well owners are responsible for testing their own water quality.</p>
                <p>Potential contaminants are sorted into three risk categories, with highest risk sources maintaining the most potential for effect. Even if drinking water providers do identify contaminants, it can be difficult to locate their origin, highlighting the importance of preventative action and strategies.</p>
            </section> 
            
            <section data-scene="end">
				 	<div class= "end-background-img background-fullscreen-setting text-responsive"><br>
                	<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>     
            </section>
        	
        	<i class="animated zoomIn infinite glyphicon glyphicon-menu-down arrow-down"></i>

        </div>
        <div id="map" class="col-sm-6 col-md-8 sidebar"></div>
    </div>
    
    <i class="fa fa-info-circle social" style="top:10px" data-toggle="modal" data-target="#info-modal"></i>
    
	<a class="fa fa-facebook-square social2" style="top:28px" href="https://facebook.com/sharer.php?u=http://rawgit.com/cartobaldrica/water_atlas/master/drinking_index.html" target="_blank"></a>
    
    <ul class="navbar text-center"></ul>

    
    <div class="modal fade" id="info-modal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h2 class="modal-title">About</h2>
                </div>
                <div class="modal-body">
                    <p2>Cover Photo by Sam Beebe/Ecotrust - retrieved from Wikimedia Commons</p2><br>
                    <p2 style="font-size:20px">Geographic Data</p2><br>
                    <p2>Surface, Ground and Contaminant Sources: Oregon Department of Environmental Quality - retrieved from Oregon Spatial Data Library</p2><br>
                	<p2 style="font-size:20px">Text Data</p2><br>
                	<p2>Drinking water statistics and information: Oregon DEQ, Oregon Health Authority, Portland Water Bureau</p2>
                </div>
                <div class="modal-footer">
                    <p2>Created with Leaflet</p>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
</div>


<script type="text/javascript">

          
    function contaminant_level(string){
        if (string == "Lower") {return '#4dff4d'}
        else if (string == "Moderate"){return '#ffff00'}
        else if (string == "Higher"){return '#cc0000'}
    	}
    	
    function setOpacity (level, step){
    	return level == step ? 1:
    		0;
    	}
    
    
    function setTotalDensity(density){
        return density >1000 ? 20 :
        density >500 ? 16:
        density >200 ? 12:
        density >50 ? 8:
        5;
    }
    
	var ground_style = {fillColor: '#0066ff', fillOpacity: .8, color: '#b3d1ff', radius: 4, opacity: 0, weight: .1};		
	var surface_style = {fillColor: '#b3d1ff', fillOpacity: .8, color: '#4d94ff', radius: 1, opacity: 1, weight: 1};
	
    var legend_sw = '<i style="background: #b3d1ff; fillOpacity: .8; color:#4d94ff; weight: 1; opacity: 0.8; border:1px solid #4d94ff"></i><b><p style="text-align: left; margin-left: 25px">Surface Source Protection Zone</b></p>';
    var legend_gw = '<i style="background: #0066ff; fillOpacity: .8; color:#b3d1ff; weight: 1; opacity: 0.8; border:1px solid #b3d1ff"></i><b><p style="text-align: left; margin-left: 25px">Groundwater Source Protection Zone</b></p>';
    var legend_grid = '<p style="text-align: center; font-weight:bold">Contaminants</p><img src="img/total.png" style="height:10px; margin-top:5px; width:10px; margin-left:1px;"><p style="font-weight:bold">Hover for number</p><br><i style="background: #0066ff; fillOpacity: .8; color:#b3d1ff; weight: 1; opacity: 0.8; border:1px solid #b3d1ff"></i><b><p style="text-align: left;  margin-left: 25px">Groundwater Zones</b></p><i style="background: #b3d1ff; fillOpacity: .8; color:#4d94ff; weight: 1; opacity: 0.8; border:1px solid #4d94ff"></i><b><p style="text-align: left;  margin-left: 25px">Surface Water Zones</b></p>';
	var legend_contaminants = '<p style="text-align: center">Potential Contaminant Sources</p><img src="img/lowest.png" style="height:10px; width:10px; margin-top:8px; margin-left:1px;"><p style = "margin-top:5px;">Lowest-Risk</p><img src="img/medium.png" style="height:10px; width:10px; margin-top:8px; margin-left:1px;"><p style = "margin-top:5px;">Medium-Risk</p><img src="img/highest.png" style="height:10px; width:10px; margin-top:8px; margin-left:1px;"><p style = "margin-top:5px;">Highest-Risk</p><br><p style="text-align:left; font-weight:bold">Hover for source name</p>';
		
//<p style="text-align:left; font-weight:bold">Hover for source</p>'

    var layers = {  
            'contaminants' : [L.geoJson.ajax('http://mapio.us/geoserver/baldricg_atlas/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_atlas:contaminants&maxFeatures=100000&outputFormat=application%2Fjson', {
            	pointToLayer: function (feature, latlng) {
    			return L.circleMarker(latlng, {
    				color: contaminant_level(feature.properties.MOD_RISK),
    				fillColor: contaminant_level(feature.properties.MOD_RISK),
    				radius: 3,
    				opacity: 1
    				}
    					).bindTooltip(feature.properties.PCS_NAME, {className: 'label_tooltip'});
    				}
				}), legend_contaminants],
			'grid1': [L.geoJson.ajax('http://mapio.us/geoserver/baldricg_atlas/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_atlas:contaminant_point_grid&maxFeatures=10000&outputFormat=application%2Fjson', {
    				pointToLayer: function (feature, latlng) {
    					return L.circleMarker(latlng, 
    						{
    							radius: setTotalDensity(feature.properties.NUMPOINTS), 
    							opacity: setOpacity(feature.properties.level, 1),
								fillOpacity: setOpacity(feature.properties.level, 1),
								fillColor: '#cc0000',
								color:'#cc0000'
		
							}
								).bindTooltip('Contaminants: ' + feature.properties.NUMPOINTS, {opacity: setOpacity(feature.properties.level, 1), className: 'label_tooltip'});}
    			}),legend_grid],	
            'surface': [L.geoJson.ajax('http://mapio.us/geoserver/baldricg_atlas/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_atlas:drinking_sw&maxFeatures=500&outputFormat=application%2Fjson',
            	{style:surface_style, onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip(feature.properties.PWS_NAME, {className: 'label_tooltip'});
    			}}
            	), legend_sw],
            'ground': [L.geoJson.ajax('http://mapio.us/geoserver/baldricg_atlas/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_atlas:drinking_gw&maxFeatures=10000&outputFormat=application%2Fjson',
            	{style:ground_style, onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip(feature.properties.TINWSYS_NA, {className: 'label_tooltip'});
    			}}
            	), legend_gw],	
            'ground2': [L.tileLayer.wms("http://mapio.us/geoserver/baldricg_atlas/wms", {
        			layers: 'baldricg_atlas:drinking_gw',
        			format: 'image/png',
        			minZoom: 6,
        			maxZoom: 15,
        			transparent: true,
    			})],
    		'ground3': [L.tileLayer.wms("http://mapio.us/geoserver/baldricg_atlas/wms", {
        			layers: 'baldricg_atlas:drinking_gw',
        			format: 'image/png',
        			minZoom: 6,
        			maxZoom: 15,
        			transparent: true,
    			}), legend_gw],
    		'surface2': [L.tileLayer.wms("http://mapio.us/geoserver/baldricg_atlas/wms", {
        			layers: 'baldricg_atlas:drinking_sw',
        			format: 'image/png',
        			minZoom: 6,
        			maxZoom: 15,
        			transparent: true,
    			})]
    		
    };

    var scenes = {
            overview: {lat: 44.1347254, lng:-122.7411479, zoom: 7, position:'fullpage'},
            surface: {lat: 44.1347254, lng:-122.7411479, zoom: 7, layers:['surface']},
            ground: {lat: 44.1347254, lng:-122.7411479, zoom: 7, layers:['ground3']},
            contaminant_grid: {lat: 44.1347254, lng:-122.7411479, zoom: 7, layers:['grid1','surface2','ground2']},
            contaminants: {lat:44.5644, lng:-123.2997, zoom: 13, layers:['contaminants' ]},
            end: {lat: 44.1347254, lng:-122.7411479, zoom: 7, position:'fullpage'}
    };
    
    

    $('.main').storymap({
        scenes: scenes,
        layers:layers,
        legend: true,
        scale:false,
        navbar: true,
        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
                var map = L.map('map',{zoomControl:false,  scrollWheelZoom:false}).setView([44.1347254, -122.7411479], 7);
            // add an basemap, which can be either OSM, mapbox, tilelayer, wmslayer or those designed by yourself.
           		/*L.tileLayer.wms("http://localhost:8080/geoserver/basemap/wms", {
        			layers: 'basemap:basemap_dark',
       				format: 'image/png',
       				minZoom: 6,
        			maxZoom: 15,
        			transparent: true,
        		attribution: "Created by Gareth Baldrica-Franklin"
    			}).addTo(map);
    			
    			L.tileLayer.wms("http://localhost:8080/geoserver/basemap/wms", {
        			layers: 'basemap:basemap_dark_labels',
        			format: 'image/png',
        			minZoom: 6,
        			maxZoom: 15,
        			transparent: true,
        			tiled: true, 
        			tilesorigin: [-180, 90]
    			}).addTo(map);
    			*/
    			
    			var CartoDB_DarkMatterNoLabels = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
					subdomains: 'abcd',
					maxZoom: 15,
					minZoom: 6
				}).addTo(map);
 				
 				var mini = new L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
					subdomains: 'abcd',
					maxZoom: 8,
					minZoom: 5
				});
				
				var miniMap = new L.Control.MiniMap(mini, { toggleDisplay: false});
 				
				miniMap.addTo(map);
			
					new L.Control.Zoom({ position: 'bottomright'}).addTo(map);

				/*if (scene == 'portland'){
				miniMap;
				}*/

            return map;
        }
    });
    
    document.getElementsByClassName("leaflet-control-attribution")[0].style.visibility = "hidden";

    
    $(document).on('click', '[data-toggle="lightbox"]', function(event) {
   		event.preventDefault();
    $(this).ekkoLightbox();
	});

</script>
</body>
</html>